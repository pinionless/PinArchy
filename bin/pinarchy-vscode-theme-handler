#!/bin/bash

# omarchy-vscode-theme-handler: Updates VSCode theme when Omarchy theme changes
# This script is called by omarchy-theme-set to keep upstream modifications minimal
# Created for Ticket 004 - Install VS Code

omarchy_update_vscode_theme() {
  local theme_name="$1"
  local vscode_settings="$HOME/.config/Code/User/settings.json"
  local vscode_theme=""
  
  # Only proceed if VSCode is installed
  if ! command -v code &> /dev/null; then
    return 0
  fi
  
  case "$theme_name" in
    "catppuccin") vscode_theme="Catppuccin Mocha" ;;
    "catppuccin-latte") vscode_theme="Catppuccin Latte" ;;
    "tokyo-night") vscode_theme="Tokyo Night" ;;
    "gruvbox") vscode_theme="Gruvbox Dark Medium" ;;
    "rose-pine") vscode_theme="RosÃ© Pine" ;;
    "nord") vscode_theme="Nord" ;;
    "kanagawa") vscode_theme="Kanagawa" ;;
    "everforest") vscode_theme="Everforest Dark" ;;
    "matte-black") vscode_theme="Matte Black" ;;
    "osaka-jade") vscode_theme="Solarized Osaka" ;;
    "ristretto") vscode_theme="Catppuccin Mocha" ;;
    *) return 0 ;;  # Skip unknown themes
  esac
  
  # Update or create settings.json with theme
  if [[ -f "$vscode_settings" ]]; then
    # Update existing settings using jq
    if command -v jq &> /dev/null; then
      jq --arg theme "$vscode_theme" '.["workbench.colorTheme"] = $theme' "$vscode_settings" > "${vscode_settings}.tmp" && mv "${vscode_settings}.tmp" "$vscode_settings"
    else
      # Fallback without jq - simple replacement
      sed -i "s/\"workbench.colorTheme\"[[:space:]]*:[[:space:]]*\"[^\"]*\"/\"workbench.colorTheme\": \"$vscode_theme\"/" "$vscode_settings"
    fi
  else
    # Create new settings file
    mkdir -p "$(dirname "$vscode_settings")"
    echo "{\"workbench.colorTheme\": \"$vscode_theme\"}" > "$vscode_settings"
  fi
  
  echo "Updated VSCode theme to: $vscode_theme"
}

# Execute the function if called with theme name
if [[ "$1" ]]; then
  omarchy_update_vscode_theme "$1"
fi