#!/bin/bash

# Reload config for all ghostty windows

if pgrep -x ghostty &> /dev/null; then
  # Get all ghostty windows - covers .ghostty pattern and TUI classes
  ghostty_addresses=$(hyprctl clients -j | jq -r '.[] | select(.class | test("\\.ghostty$|^TUI\\.(float|tile)$")) | .address')
  
  if [[ -n "$ghostty_addresses" ]]; then
    # Save current active window
    current_window=$(hyprctl activewindow -j | jq -r '.address')
    
    # Focus each ghostty window and send reload key combo
    while IFS= read -r address; do
      hyprctl dispatch focuswindow "address:$address"
      sleep 0.05
      hyprctl dispatch sendshortcut "CTRL SHIFT, comma, address:$address"
    done <<< "$ghostty_addresses"
    
    # Return focus to original window
    if [[ -n "$current_window" ]]; then
      hyprctl dispatch focuswindow "address:$current_window"
    fi
  fi
fi