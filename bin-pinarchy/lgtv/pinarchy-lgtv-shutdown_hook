#!/bin/bash

# LG TV Shutdown Hook Management
# Usage: pinarchy-lgtv-shutdown_hook <TV_IP>

set -e

TV_IP="$1"

main() {
  if [[ -t 0 && -t 1 ]]; then
    if [ -z "$TV_IP" ]; then
      echo "‚ùå Usage: pinarchy-lgtv-shutdown_hook <TV_IP>"
      exit 1
    fi
    clear
    omarchy-show-logo
    echo "üì∫ LG TV Shutdown Hook"
    echo "   IP: $TV_IP"
    echo
  fi

  SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
  source "$SCRIPT_DIR/fn-lgtv-shutdown.sh"
  
  local config_file="$HOME/.config/lgtv/config.json"
  
  local tv_name=$(jq -r --arg ip "$TV_IP" '.tvs[] | select(.ip == $ip) | .name' "$config_file")

  if [ -z "$tv_name" ]; then
    echo "‚ùå TV with IP $TV_IP not found in configuration"
    return 1
  fi
  
  if [ "$(check_shutdown_hook_exists "$TV_IP")" = "true" ]; then
    echo "Current status: ‚úÖ Shutdown hook is ENABLED"
  else
    echo "Current status: ‚ùå Shutdown hook is DISABLED"
  fi
  echo
  
  # Show enable/disable confirmation with custom buttons
  if gum confirm "Turn off TV on system shutdown:" --affirmative="Enable" --negative="Disable"; then
    add_shutdown_hook "$TV_IP"
  else
    remove_shutdown_hook "$TV_IP"
  fi
}

main